<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Sorting Large Files in Constant Space | defcore </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Sorting Large Files in Constant Space | defcore ">
    <meta name="generator" content="docfx 2.15.5.0">
    
    <link rel="shortcut icon" href="../icons/favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    <meta property="docfx:rel" content="../">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../icons/logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
              <h1 id="sorting-large-files-in-constant-space">Sorting Large Files in Constant Space</h1>
              
<p>The following examples shows how to use the system to sort large files in constant space</p>
<pre><code class="lang-csharp">public class SortingDis : Job
{
    public override void Main(string[] args)
    {
        var lineCount = 0;
        var filename = args[0];
        // File.OpenText() does not read the entire thing into memory
        using (var reader = File.OpenText(filename))
        {
            // Count the number of lines in the file
            while (reader.ReadLine() != null)
            {
                lineCount++;
            }
        }
        // Number of tasks to create is dynamic
        var splitSize = int.Parse(args[1]);
        for (var i = 0; i &lt; splitSize; i++)
        {
            AddTask(new SortTask(filename, lineCount, i, splitSize));
        }
    }

    ...
}
</code></pre><p>The SortingDis program extends the job class, is passed a large file with one item per line, and
the number of tasks to create.</p>
<pre><code class="lang-csharp">    public class SortTask : JobTask
    {
        private const int MaxMemory = 100000000;

        ...

        public SortTask(string filename,
            int lineCount, int section, int splitSize)
        {
            // init variables
            ...
            //
        }

        public override void Main(string[] args)
        {
            // split the file up into smaller pieces
            Split();
            // create a job result from the sorted pieces
            var jobResult = new SortResult { ResultPaths = Sort() };
            // add the result to our results
            AddResult(jobResult);
        }
    }
</code></pre><p>The SortTask class does the actual work of sorting some portion of the file</p>
<pre><code class="lang-csharp">    public class SortResult : JobResult
    {
        public List&lt;string&gt; ResultPaths { get; set; }
    }
</code></pre><p>The SortResult extends a JobResult which allows it to be aggregated and sent back. JobResult
uses Json serialization under the hood.</p>
<pre><code class="lang-csharp">// within SortingDis
public override void RunFinalTask()
{
    ...
    // Merge the resulting tasks
    ...
}
</code></pre><p>The SortingDis class overrides the RunFinalTask() method which runs on the same node
the Job was submitted on at the very end using anything within Results which is generated from all
the nodes completing tasks.</p>

            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/acf5118/MS-Project/blob/master/docs/articles/sort_example.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Copyright © 2017 Adam Fowles
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
